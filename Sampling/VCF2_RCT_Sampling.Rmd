---
title: "VCF2 - Sampling"
author: "Jonathan Karl"
date: '2023-04-19'
output: html_document
---


```{r}
library(dplyr)
library(sp)
options(scipen = 999)
```


```{r}
nairobi <- 4397073
kajiado <- 1117840
kiambu <- 2454504
machakos <- 1421932

total_study_area_pop <- nairobi + kajiado + kiambu + machakos

# The real stuff
recruitment <- 16538
baseline <- 12250
endline <- 8500


# For IRB
recruitment <- 19250
baseline <- 14000
endline <- 10000



# Nairobi
round((nairobi/total_study_area_pop)*recruitment/4) # Recruitment
round((nairobi/total_study_area_pop)*baseline/4) # Baseline
round((nairobi/total_study_area_pop)*endline/4)# Endline

# Kajiado
round((kajiado/total_study_area_pop)*recruitment/4) # Recruitment
round((kajiado/total_study_area_pop)*baseline/4) # Baseline
round((kajiado/total_study_area_pop)*endline/4) # Endline

# Kiambu
round((kiambu/total_study_area_pop)*recruitment/4) # Recruitment
round((kiambu/total_study_area_pop)*baseline/4) # Baseline
round((kiambu/total_study_area_pop)*endline/4) # Endline

# Machakos
round((machakos/total_study_area_pop)*recruitment/4) # Recruitment
round((machakos/total_study_area_pop)*baseline/4) # Baseline
round((machakos/total_study_area_pop)*endline/4) # Endline



# Final sample into clusters - How many clusters per place?
as.matrixc(c(nairobi = round((nairobi/total_study_area_pop)*endline)/85,
kajiado = round((kajiado/total_study_area_pop)*endline)/85,
kiambu = round((kiambu/total_study_area_pop)*endline)/85,
machakos = round((machakos/total_study_area_pop)*endline)/85))

```

To implement the design, we first conducted a census of all hair salons in Lusaka, collecting GPS coordinates and numerous salon and stylist characteristics. We then imposed a grid on the GPS-mapped locations of the salons, to divide the city into equal geographical areas of 650 by 650 m each. We excluded a buffer of 75 m on all sides of the grid cell, resulting in at least 150 m between salons in adjacent areas. The resulting areas, each measuring 250,000 m2, served as the unit of randomization. Salons located in buffer areas were not invited to join the program. The final sample for randomization consists of 205 distinct neighbourhoods, containing 1222 hair salons.

```{r}

# Read in Shapefile
shp_kenya_adm3 <- rgdal::readOGR(dsn = "gadm41_KEN_shp/gadm41_KEN_3.shp")

# Select relevant counties
shp_kenya_adm3 <- shp_kenya_adm3[shp_kenya_adm3$NAME_1 %in% c("Nairobi", "Machakos", "Kajiado", "Kiambu")]
length(unique(shp_kenya_adm3@data$NAME_3))
length(unique(shp_kenya_adm3@data$NAME_2))

length(unique(shp_kenya_adm3@data$NAME_3[shp_kenya_adm3@data$NAME_1 == "Nairobi"]))

# Randomly select 100 wards

shp <- st_read("gadm41_KEN_shp/gadm41_KEN_3.shp")
area <- st_area(shp)
shp$area <- area
shp_df <- as.data.frame(shp)
temp <- shp_df %>% 
  group_by(NAME_1) %>% 
  summarise(area = sum(area)) %>% 
  filter(NAME_1 %in% c("Nairobi", "Kajiado", "Kiambu", "Machakos")) %>% 
  mutate(area = as.numeric(area))

((pi*(1609.34^2))*100)/sum(temp$area)
(((2*1609.34)^2)*100)/sum(temp$area)

# Define the area of interest. By coordinates.


# Select 100 clusters.
st_sample(shp,size = 12, progress = T)

# Randomise the clusters into treatment groups.


# Nairobi: all
# Kajiado
kajiado <- c("Ngong", "Oloolua", "Nkaimurunya", "Ongata Rongai", "Kitengela", "Olkeri")

# Machakos
machakos <- c("Athi River", "Syokimau/Mulolongo")

# Kiambu
kiambu <- c("Kiuu", "Township", "Muchatha", "Kihara", "Kabete", "Uthiru", "Kinoo", "Kikuyu", "Karai")


# "NAME_1" IN ('Nairobi') OR "NAME_3" IN ('Ngong', 'Oloolua', 'Nkaimurunya', 'Ongata Rongai', 'Kitengela', 'Olkeri', 'Athi River', 'Syokimau/Mulolongo', 'Kiuu', 'Township', 'Muchatha', 'Kihara', 'Kabete', 'Uthiru', 'Kinoo', 'Kikuyu', 'Karai')

```


